import{a as f}from"./chunk-WPAPV4J4.js";import{d as oe,e as se,f as re,g as ae,h as pe}from"./chunk-L7BSNPE2.js";import{b as W,g as X,l as Z,n as ee,p as te,q as ne,r as ie}from"./chunk-CYDWIF3P.js";import{a as j,c as L,d as G,e as Q,f as q,g as Y,h as J,i as K}from"./chunk-72AFM3JC.js";import{Aa as s,Ba as r,Ca as P,Da as S,Ga as g,Ia as y,Ma as p,Mb as U,Na as h,Oa as x,Qa as _,Ra as O,Sa as d,Ta as u,U as v,Ua as k,Wa as F,X as D,Xa as N,Ya as T,Z as M,_ as I,eb as A,fb as B,gb as E,ib as R,jb as V,kb as w,la as a,ma as b,tb as $,ua as m,wb as z,ya as C,yb as H}from"./chunk-RVRWXEWA.js";var ge=o=>({"my-message":o}),ce=(()=>{let i=class i{constructor(){this.currentUserId=f.currentUser["rs-uid"],this.currentCompanionName=null}ngOnInit(){this.getCompanionName()}getCompanionName(){this.message.authorID!==this.currentUserId&&(this.currentCompanionName=f.getCurrentCompanionName(this.message.authorID))}isMyMessage(){return this.message.authorID===this.currentUserId}};i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=v({type:i,selectors:[["app-message"]],inputs:{message:"message"},standalone:!0,features:[_],decls:8,vars:9,consts:[[1,"container",3,"ngClass"],[1,"author"],[1,"date"],[1,"message"]],template:function(e,t){e&1&&(s(0,"div",0)(1,"div",1),p(2),r(),s(3,"div",2),p(4),d(5,"date"),r(),s(6,"div",3),p(7),r()()),e&2&&(m("ngClass",O(7,ge,t.isMyMessage())),a(2),x("",t.currentCompanionName||"My message",":"),a(2),h(k(5,4,t.message.createdAt,"medium")),a(3),h(t.message.message))},dependencies:[w,A,V],styles:["[_nghost-%COMP%]{width:100%;display:block;margin-bottom:5px;position:relative}.container[_ngcontent-%COMP%]{width:45%;min-height:80px;position:relative;background-color:#fafafa;border-radius:0 15px 15px;padding:10px}.author[_ngcontent-%COMP%]{max-width:280px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:Roboto,sans-serif;font-size:14px;font-style:normal;font-weight:700;line-height:normal;color:#797979}.date[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:12px;font-style:normal;font-weight:400;line-height:normal;position:absolute;top:10px;right:10px;color:#27ae60}.message[_ngcontent-%COMP%]{max-width:90%;min-height:40px;margin-top:15px;font-family:Roboto,sans-serif;font-size:16px;font-style:normal;font-weight:400;line-height:normal;color:#000;overflow:hidden}.my-message[_ngcontent-%COMP%]{position:relative;left:640px;border-radius:15px 0 15px 15px;background-color:#addfad}"]});let o=i;return o})();var le=(()=>{let i=class i{transform(n){return[...n].sort((t,c)=>+t.createdAt-+c.createdAt)}};i.\u0275fac=function(e){return new(e||i)},i.\u0275pipe=D({name:"sortMessagesByDatePipe",type:i,pure:!0,standalone:!0});let o=i;return o})();var fe=["messagesContainer"];function he(o,i){if(o&1&&(s(0,"div",16),p(1),r()),o&2){let l=i.ngIf;a(1),x(" ",l,"")}}function ve(o,i){if(o&1&&P(0,"app-message",17),o&2){let l=i.$implicit;m("message",l)}}function be(o,i){if(o&1){let l=S();s(0,"div",18)(1,"div",19)(2,"h2",20),p(3,"Do you really want to delete the conversation?"),r(),s(4,"div",21)(5,"button",22),g("click",function(){M(l);let e=y();return I(e.deleteConversation())}),d(6,"async"),p(7,"Delete"),r(),s(8,"button",23),g("click",function(){M(l);let e=y();return I(e.hidePopup())}),d(9,"async"),p(10,"Cancel"),r()()()()}if(o&2){let l=y();a(5),m("disabled",u(6,2,l.isSubmitInProgress$)),a(3),m("disabled",u(9,4,l.isSubmitInProgress$))}}var Ee=(()=>{let i=class i{constructor(n,e,t){this.route=n,this.store=e,this.fb=t,this.currentUser=f.currentUser,this.companionName=null}ngOnInit(){this.conversationID=this.route.snapshot.paramMap.get("conversationID"),this.initializeForm(),this.subscribeToConversationMessages(),this.messages.length||this.loadHistory(void 0),this.since&&this.loadHistory(this.since),this.conversationTimerValue$=this.store.select(se),this.isRefreshing$=this.store.select(re),this.isShowPopup$=this.store.select(ae),this.isSubmitInProgress$=this.store.select(pe)}ngAfterViewInit(){this.scrollToBottom()}initializeForm(){this.messageForm=this.fb.group({message:[""]})}subscribeToConversationMessages(){this.conversationHistorySubscr$=this.store.select(oe).subscribe(n=>{let e=n.find(t=>t[this.conversationID]!==void 0);this.messages=e?e[this.conversationID]:[],this.getSince(),this.getCompanionName(this.messages)})}getCompanionName(n){let e=n.find(t=>t.authorID!==this.currentUser["rs-uid"]);this.companionName=f.getCurrentCompanionName(e?.authorID)}loadHistory(n,e=!1){this.store.dispatch(W({payload:{conversationID:this.conversationID,since:n,isLoadManual:e}}))}getSince(){this.since=+this.messages.reduce((n,e)=>{let t=+e.createdAt;return t>n?t:n},0)}onSubmit(n){if(n.preventDefault(),this.messageForm.get("message")?.value){let e=new Date().getTime();this.store.dispatch(X({payload:{createdAt:e,authorID:this.currentUser["rs-uid"],conversationID:this.conversationID,message:this.messageForm.get("message")?.value,since:this.since}})),this.messageForm.get("message")?.reset()}}refreshPeople(){this.loadHistory(this.since,!0),this.store.dispatch(Z())}scrollToBottom(){if(this.messagesContainer){let n=this.messagesContainer.nativeElement;n.scrollTop=n.scrollHeight}}deleteConversation(){this.store.dispatch(ee({conversationID:this.conversationID})),this.store.dispatch(te())}hidePopup(){this.store.dispatch(ne())}showPopup(){this.store.dispatch(ie())}getMessageID(n,e){return e.authorID+e.createdAt}ngOnDestroy(){this.conversationHistorySubscr$.unsubscribe()}};i.\u0275fac=function(e){return new(e||i)(b($),b(U),b(J))},i.\u0275cmp=v({type:i,selectors:[["app-conversation"]],viewQuery:function(e,t){if(e&1&&N(fe,5),e&2){let c;F(c=T())&&(t.messagesContainer=c.first)}},standalone:!0,features:[_],decls:25,vars:16,consts:[[1,"wrapper"],[1,"container"],[1,"conversation-buttons-container"],["type","button",1,"green-button","shadow-button","conversation-button","refresh-button",3,"disabled","click"],["type","button",1,"green-button","shadow-button","conversation-button","delete-conversation-button",3,"click"],["rel","stylesheet","routerLink","/",1,"go-home-link"],["class","timer-value",4,"ngIf"],[1,"conversation-title"],[1,"messages-container"],["messagesContainer",""],["class","my-message",3,"message",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-container"],[1,"form",3,"formGroup","submit"],["formControlName","message","id","message","name","message","type","text","placeholder","Enter Your Message Here:",1,"form-input","message-input"],["type","submit",1,"green-button","conversation-submit-button",3,"disabled"],["class","popup-container","id","popupContainer",4,"ngIf"],[1,"timer-value"],[1,"my-message",3,"message"],["id","popupContainer",1,"popup-container"],[1,"popup"],[1,"delete-conversation-popup-title"],[1,"popup-buttons-container"],["type","submit",1,"green-button","shadow-button","save-new-group","form-btn","popup-btn","form-btn",3,"disabled","click"],["type","button","id","popupCancel",1,"green-button","shadow-button","cancel-new-group","form-btn","popup-btn",3,"disabled","click"]],template:function(e,t){if(e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),g("click",function(){return t.refreshPeople()}),d(4,"async"),p(5,"Refresh Messages"),r(),s(6,"button",4),g("click",function(){return t.showPopup()}),p(7,"Delete Conversation"),r(),s(8,"a",5),p(9,"To main page"),r(),C(10,he,2,1,"div",6),d(11,"async"),r(),s(12,"h1",7),p(13),r(),s(14,"div",8,9),C(16,ve,1,1,"app-message",10),d(17,"sortMessagesByDatePipe"),r(),s(18,"div",11)(19,"form",12),g("submit",function(de){return t.onSubmit(de)}),P(20,"input",13),s(21,"button",14),p(22,">"),r()()()()(),C(23,be,11,6,"div",15),d(24,"async")),e&2){let c;a(3),m("disabled",u(4,8,t.isRefreshing$)),a(7),m("ngIf",u(11,10,t.conversationTimerValue$)),a(3),h(t.companionName),a(3),m("ngForOf",u(17,12,t.messages))("ngForTrackBy",t.getMessageID),a(3),m("formGroup",t.messageForm),a(2),m("disabled",!((c=t.messageForm.get("message"))!=null&&c.value)),a(2),m("ngIf",u(24,14,t.isShowPopup$))}},dependencies:[w,B,E,R,H,z,K,Q,j,L,G,q,Y,ce,le],styles:[".conversation-buttons-container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;gap:50px;margin-bottom:20px}.conversation-button[_ngcontent-%COMP%]{padding:10px}.timer-value[_ngcontent-%COMP%]{position:absolute;top:7px;left:420px;font-family:Roboto,sans-serif;font-size:18px;font-style:normal;font-weight:700;line-height:normal;color:#eb5757}.go-home-link[_ngcontent-%COMP%]{position:absolute;top:0;right:10px;color:#27ae60;border-bottom:1px solid #27AE60}.conversation-title[_ngcontent-%COMP%]{margin-left:20px;font-family:Roboto,sans-serif;font-size:22px;font-style:normal;font-weight:700;line-height:normal;color:#000}.messages-container[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 280px);background-color:#f4f4f7;border-radius:5px;padding:10px;overflow:auto}.form-container[_ngcontent-%COMP%]{width:100%;padding:10px 20px;margin:0 auto;position:fixed;left:0;bottom:0}.form[_ngcontent-%COMP%]{width:1200px;margin:0 auto;display:flex;justify-content:center;align-items:center;flex-direction:row}.form-input[_ngcontent-%COMP%]{display:block;width:80%;margin:20px 0}.form-input[_ngcontent-%COMP%]::placeholder{color:#f4f4f7}.conversation-submit-button[_ngcontent-%COMP%]{height:37px;width:40px;font-family:Roboto,sans-serif;font-size:30px;font-style:normal;font-weight:700;line-height:normal;border-radius:0 5px 5px 0}.conversation-submit-button[_ngcontent-%COMP%]:active:not([disabled]){background-color:#1f8e48}.popup-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#000000b3;display:flex;justify-content:center;align-items:center;z-index:9999}.popup[_ngcontent-%COMP%]{width:400px;min-height:20px;background-color:#eee;padding:20px;border:1px solid #CCC;box-shadow:0 0 10px #0000001a;border-radius:5px}.popup-buttons-container[_ngcontent-%COMP%]{width:100%;margin:0 auto;display:flex;justify-content:center;align-items:center;gap:20px}.popup-btn[_ngcontent-%COMP%]{margin:20px 0 15px}.delete-conversation-popup-title[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;font-size:18px;font-style:normal;font-weight:700;line-height:normal;color:#797979;text-align:center}"]});let o=i;return o})();export{Ee as ConversationComponent};
